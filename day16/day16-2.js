const movement = { "left": [0, -1], "right": [0, 1], "up": [-1, 0], "down": [1, 0] }
const produceResult = () => {

    let totalEnergized = 0
    const positionOutOfGrid = (position) => {
        return (position[0] < 0 || position[0] > maxRow) || (position[1] < 0 || position[1] > maxColumn)
    }

    const directionVertical = (direction) => {
        return direction == 'up' || direction == 'down'
    }
    const directionHorizontal = (direction) => {
        return direction == 'left' || direction == 'right'
    }

    const tileDirectionProcessedBefore = (direction, tile) => {
        return (direction == 'up' ? tile.up : (direction == 'down' ? tile.down : (direction == 'left' ? tile.left : tile.right)))
    }

    const directionIndicator = (tile) => {
        let indicator = ''
        indicator = tile.up ? '^' : tile.down ? 'V' : tile.left ? '<' : tile.right ? '>' : '#'
        return indicator
    }


    const processBeam = (row, column, direction) => {
        let position = [row, column]
        let vector = movement[direction]
        let goOn = true
        while (goOn) {
            position[0] += vector[0]
            position[1] += vector[1]

            if (positionOutOfGrid(position)) {
                break // this beam/beam has left the grid and can be let go off
            }
            const tile = grid[position[0]][position[1]]
            if (tile.energized && tileDirectionProcessedBefore(direction, tile)) break  // if the tile has been visited before for the same beam direction then we are done with it
            if (!tile.energized) { tile.energized = true; totalEnergized++; }
            tile[direction] = true
            if (tile.tileType == '-' && directionVertical(direction)) {
                processBeam(position[0], position[1], "left");
                processBeam(position[0], position[1], "right");
                break
            } // split into horizontal
            if (tile.tileType == '|' && directionHorizontal(direction)) {
                processBeam(position[0], position[1], "up");
                processBeam(position[0], position[1], "down");
                break
            } // split into vertical 
            if (tile.tileType == 'L' || tile.tileType == 'J') {
                let newDirection
                if (tile.tileType == 'J') {  //   / 
                    newDirection = (direction == 'up' ? "right" : (direction == 'down' ? "left" : (direction == 'left' ? "down" : "up")))
                } else { // \
                    newDirection = (direction == 'up' ? "left" : (direction == 'down' ? "right" : (direction == 'left' ? "up" : "down")))

                    // replace / with J and \ with L
                }
                processBeam(position[0], position[1], newDirection);


                break
            } // reflect 
        }
    }

    const lines = inputDoc.split('\n');
    // tiles { tileType: '/\|-.', energized: boolean, up: down: left: right: top }
    // prepare grid
    const startingGrid = []
    const maxRow = lines.length - 1
    const maxColumn = lines[0].length - 1
    for (const line of lines) {
        const row = []
        for (let column = 0; column <= maxColumn; column++) {
            row.push({ tileType: line[column], energized: false, up: false, down: false, left: false, right: false })
        }
        startingGrid.push(row)
    }
    // start on 0,-1 : left
    // go through row zero until mirror, energize everything along the way
    // with mirror, start new beam(es)
    // stop beam if no new tiles updated - either with energized or directions
    let grid = JSON.parse(JSON.stringify(startingGrid))
    let maxTotalEnergized = 0

    let maxEntrance = [-2, -2]
    for (let column = 0; column <= maxColumn; column++) {
        totalEnergized = 0
        grid = JSON.parse(JSON.stringify(startingGrid))
        processBeam(-1, column, 'down')
        if (totalEnergized > maxTotalEnergized) { maxTotalEnergized = totalEnergized; maxEntrance = [-1, column] }

        totalEnergized = 0
        grid = JSON.parse(JSON.stringify(startingGrid))
        processBeam(maxRow+1, column, 'up')
        if (totalEnergized > maxTotalEnergized) { maxTotalEnergized = totalEnergized; maxEntrance = [maxRow+1, column] }
    }
    for (let row = 0; row <= maxRow; row++) {

        let totalEnergized = 0
        grid = JSON.parse(JSON.stringify(startingGrid))
        processBeam(row, -1, 'right')
        if (totalEnergized > maxTotalEnergized) { maxTotalEnergized = totalEnergized; maxEntrance = [row, -1] }

        totalEnergized = 0
        grid = JSON.parse(JSON.stringify(startingGrid))
        processBeam(row, maxColumn+1, 'left')
        if (totalEnergized > maxTotalEnergized) { maxTotalEnergized = totalEnergized; maxEntrance = [row, maxColumn+1] }

    }
    console.log(`Maximum Total Energized Tile Count ${maxTotalEnergized} at ${maxEntrance} `)

    // for (let row = 0; row <= maxRow; row++) {
    //     let tiles = ""
    //     for (let column = 0; column <= maxColumn; column++) {
    //         tiles = tiles +  (grid[row][column].energized ? "#" : grid[row][column].tileType)
    //     }
    //     console.log(tiles)
    // }
    // console.log(`
    // ----------------------------------------------------------------
    // Direction Graph
    // `)
    // for (let row = 0; row <= maxRow; row++) {
    //     let tiles = "   "
    //     for (let column = 0; column <= maxColumn; column++) {
    //         tiles= tiles + (!grid[row][column].energized ? grid[row][column].tileType 
    //             : grid[row][column].tileType =='.'? directionIndicator(grid[row][column])
    //             :grid[row][column].tileType)
    //     }
    //     console.log(tiles.replace(/J/g,"/").replace(/L/g,"\\"))
    // }
}


// replace / with J and \ with L

const inputDoc2 = `.|...L....
|.-.L.....
.....|-...
........|.
..........
.........L
....J.LL..
.-.-J..|..
.|....-|.L
..JJ.|....`


const inputDoc = `L..........J.......-........|....L.......-..LJ....|................L..........J.|...J.J........L...........J..
...............L..L................J............L.................J..................J.........L..|....|J|-...
...J..........................L.....|.............-........J.J.......-.|....J|.....-L........-......J.........
|..........................-..........-.......J............................-..|................-..............
.....|........J.....J.......-.L..............................-........|............|J...J..J.........J........
..L...|..-......L.........-L.||........|.J................L....L........-..L....................J..L....-...|.
.|...........|............-.........J.-.................|.|......J...............|....J..-..-...L...........|.
..............L.............................................................J.......................JL....-...
.J........|...L.L..|..-....L............................|.........J.................|J...............-........
L....L.J...............J..................J....|.......J..........J.L.......J........-....L........J......J|..
.J......--..........L..|.--........-.....J.......J........L.....|J..................|JJ...........|.........-.
.......|.....L-.L..-......-.........|.....................-JL.....-..........|.............-....L.....L.-.....
..--...L....-..|..................................-......-......L......-................L.....J..-J....--.....
....-.........................L.L............|...............|.....-...L....|-................................
.................-..|.L..L....-..........|.....J.....-...-.-..J...............J................-..............
-..-......|..............................L.....L........|.....J........L...................J..................
..............-.....-.|..........|.L..................|........|...........L.L...|........-...................
..L............J...LL..........J...-..L...J.........L..|..................J......L..-...J....................L
..................|...L.......................J...|........J..............-.J...L........L.......J|...L..-..-.
.................................................-................|.........................................L.
......-...............................|.J.............J...........................-LJ....J......L..........L..
......L....|..........................L.-|..........................|....................L.....LJ...-.........
..L..-|...|.....-.....J.......J....|...............L................|..|.......L...........................-..
..L......-.......L.........L................|...........|......J.....J..........-.J...-|....................J.
.................J.......L...|.....L....-.................J........J..L...........-...|...J|................L.
..|..L.J.........L.L.......................-......|....-....J...J................-.......L..J...J.....J.......
..........J.........J..|..-....................LL............L........................-......-......|.........
...J-....L..L..........L....LL.......................................J........L...-.................L.........
..................................J.................|..L.-..|................|J....-.........................|
...-.................||....J....................-..........................................|.-................
..JJ.L..........................|.....|-.............L.L......-....L.L.......L............-..............L-...
.......|.|..-.........J..|........-.....|........................-...................-......L................-
..-..|..........|....-.............|.|J.....J..J..................L...L..................J......|....|........
........L...J.J...............J...............J....-..J.....|....L................|J...J.....|.|-..|..........
......|..........L...-.J........-...............................L..........|.............|..L..|.......J.....|
.............................-................................................|................J......L...J..-
......-........L..........-....J...............L............J.....L......|........................-.|...J.....
...L...............-....-........-............-.....J....|.L...J.......L..-....................|........|.....
.............................-...L....|...|.......L............................-............L.................
....................|...-........-.........-..L................J......................J.|.......-.............
......L...........................J....-....|...........................................L...-.........|......L
.............L..JL..............|L.L..........|L...J....................JL...................|L.......L.......
J...................J.LL...........................J...........-...-..........-..-............................
............L........J........-...........J.........J.................-.................J...........|.........
.........L.......|.......L.........J.....................L..............LL......J...|-....L..|..-.....|.......
.|....-.............L.........L.L..J.......-...........................L.J..........................--L......L
.........J....J.................J.................L.............................................J..J.L........
.....-..............-.-...LJ..|....-.........J.....................L.................J.L..........-...|....|..
........|...|.-.......|.......-............L...J....|...L..............J............-.........................
........................|.....L.........................JLJ.........................|.........................
....L...J.J..........|.....L......................-.................J.....|...............................|-..
...J...........J.-......L....J.................-...L.....-......L.....L..............JJ.|..............-..-...
......J.............J-J.L...........L...L..|J........................-.....J......L........-.JL..........||...
...................................J............|......................J..|.....L......L............J.........
.....|....L...|.-.J.............................J..-....|.L.......................-..J.-..-.........L.........
..........L...|..J.......-|............-..........J.....J..........-......-..J.-......|....J.-...J............
.-.........-............|J.......-........|...................-.........-..........J.-........L..........|J...
.........L.........L......J....|...LL......-..........-................L................................-.....
............-.....J......|...JJ........L-....|........J.........J..................-..................J....--.
...............|.................................|...J...L....................L................|...L.|........
..............L.........L.........L....|.-.......L.L........-...........J...|.....|..............L.......L....
........-.-.....|...J......-L..|.....-.........|.-................L.......J....L...-.....L..|J...............|
....|.....................-...................L......L......-.......................-.....J.........J....L....
..|...|.......L.J..-..............L.............................................L..J....|.....................
..................-..J........|.....-L...J.................................................J..L...|......-...-
.....L......L........L.....................|...|..J........J......J.L.........J...............................
..............J..........J...........L..LJ..|.L...|..........-................................L-..............
J...............L...|......L............J|...................|.....J.J...L............................-.|.....
...........|................J-......L.....-.........-...............J.......J..............J|.................
..-...........|..L.............L....|J...............|....J..............L...............|.J......|.........J.
.....LL..|......L....L.......-.................L.-......................|.........J...|.........|...|...-.....
-.....J....|......J.............J.......|J..JL...............J.....J-L...J-.......|..........J..............LL
..........L......................J.................|...--..J..................................................
.L...................J......|......-.............................JJ......|...J|.|....L.............L..........
.L-...........-.........|....................................J........|........J...-............L....-...-....
......L......|................-.....J....|........-..L.....-........JJ..................J.....|.........-.....
.....-..........-.|J.........-......................J......|.|.J.........................................JLL|.
...L................|...........J..-....|..-..........|..........J....-......J.......J.....-..L.....LL....J...
.....L.....-..................-...-....J....|....|.................|...L.J...............J.......|.LJ.....J...
.||........J..........J.-...|...........L.................L........-........|........................-...|....
.........J......L......|...............L.L.................................................L.................|
..........................|....................|....J-...............|....|........J....-..................|..
.-........L.|........J...|...................|.........|............L.....|.......L.........J.................
................-........................L...........|..................J................-.............L......
.......L..........|...............J...|.-........................J....L.............-.......L.J...............
..........L...........................................-........|.......L.........J...-........L...............
..J.......J...L|...............-........L.................J...L.....................J.....-.-....-...........-
.L..J........J....-L................................|.....-..|...............................-................
..........................L.....|................J.....L........J.............|..............L.......J-..|....
|.........-.|.............J......-.................|.......|...LJ...........|...........................LL....
-..................|.........................-.............-.....|....J.........L...-J.....|............JL....
.........L.L....L...........|....-...J..............|.....|-.......L.............-.......J.......J.J.......L..
....J.....-...........................................L...J..L.|.......................-..JJ....-......|......
.J-..................L..L....................................L.......J.L....|.................................
.....J....................................-....-J........................-J.........-.L...|.......J..-.L......
.....|.............-.......|-..-.................................|-...........................L.|.....|.......
.........L-.............L...............J....-....|....-.|..........L............|.L...|.....-................
............J.......-....|.J....|..J....J.......J..L.................-..................|.....................
..J....-.........J.....L...............L......-....|...L..........J.....|........................L............
.....J.L.............L.........................-..|.......|......-......|.................J.......J-..........
...L..........L.......................L.-...J.J.........|..L..................L.....J...|.......|............-
.........J............-..................................|.....................-..............................
........................|.....L.........L..............-..L..........||.....J.LL.J......J.....................
.................-.............L...J...........L...L......--................L.....L.............L....-........
...J-..........L.L............-.......-.............L..L.L.....J........|...-..-..|..........L................
L.|..L......L-.......J.........||..L.........................................................-.....J..........
....|..........................................L......-..........L...J...L-........|..........................
.......-.......L..JJ.J....|...............L.L..-...L....|....................-......L......L..-........J......
J....J..J....-..J....-....-......................L.........J..........-J..L.......J..L-...J..........|........
.|....LL.........J....L.............-......--L...........|.........|..L.....................J.........J.L.....`

produceResult()